import dotenv from 'dotenv';
import { expect } from 'chai';
import { BalancerSdkConfig, BalancerSdkSorConfig, Network } from '@/.';
import { mockPool, mockPoolDataService } from '@/test/lib/mockPool';
import { Pools } from '../pools.module';

dotenv.config();

const sorConfig: BalancerSdkSorConfig = {
    tokenPriceService: 'coingecko',
    poolDataService: mockPoolDataService,
    fetchOnChainBalances: false,
};

const sdkConfig: BalancerSdkConfig = {
    network: Network.KOVAN,
    rpcUrl: `https://kovan.infura.io/v3/${process.env.INFURA}`,
    sor: sorConfig,
};

describe('pools join module', () => {
    describe('encodedExactTokensInJoinPool', () => {
        it('should return an ABI byte string', async () => {
            const pools = new Pools(sdkConfig);
            const encodedExactTokensInJoinPool =
                await pools.join.encodedExactTokensInJoinPool(
                    '0x35f5a330FD2F8e521ebd259FA272bA8069590741',
                    mockPool.id,
                    mockPool.tokensList,
                    ['5489.603901499267423531', '6.627784151437690673'],
                    '0.01'
                );
            expect(encodedExactTokensInJoinPool).to.equal(
                '0xb95cac285c6ee304399dbdb9c8ef030ab642b10820db8f5600020000000000000000001400000000000000000000000035f5a330fd2f8e521ebd259fa272ba806959074100000000000000000000000035f5a330fd2f8e521ebd259fa272ba80695907410000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000ba100000625a3754423978a60c9317c58a424e3d000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000129978edf3ede4d1d2b0000000000000000000000000000000000000000000000005bfa9e91fa68473100000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000098dd931dc09bfc85e80000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000129978edf3ede4d1d2b0000000000000000000000000000000000000000000000005bfa9e91fa684731'
            );
        });
    });
});
